# Event deck

Виджет отображает стопку событий, открытые карты и сброс. Он не мутирует состояние: все данные передаются в виде снапшота, а пользовательские действия транслируются наружу через колбэки намерений. Конфигурация поступает из JSON-файла с описанием карт и границами добора за одно событие.

## Использование
- Импортируйте `EventDeck` и конфигурацию: `import deckSource from "../../data/event-deck.json";`
- Создайте экземпляр: `const deck = new EventDeck(container, deckSource as EventDeckConfig)`.
- Передайте колбэки, чтобы обрабатывать намерения пользователя: `deck.setIntentHandlers({ onTrigger, onReveal, onDiscard });`. Колбэк `onDiscard` получает уникальный `cardInstanceId`, который движок присваивает каждой копии события.
- Обновляйте UI с помощью `deck.applySnapshot(snapshot)`, где `snapshot` содержит массивы `drawPile`, `revealed`, `discardPile` и опциональный статус.

## Поведение
- Колода отображается как стопка карт рубашкой вверх; счётчик показывает количество оставшихся карт.
- Панель управления содержит кнопку «Вызвать судьбу» (случайный добор в диапазоне `draw.min`/`draw.max`) и поле «Открыть N карт», значение которого нормализуется внутри виджета.
- Открытые события выводятся вертикальным списком с прокруткой. Клик по карточке вызывает `onDiscard(cardInstanceId)` и ожидает, что движок опубликует обновлённый список через снапшот.
- Карточки могут содержать бейджи и дополнительную мета-информацию: например, для врагов отображается состояние «В игре» и локация, где находится жетон.

## Формат карт
- Поля `type` и `enter` необязательные и расширяют поведение события. Значение `type: "enemy"` сигнализирует движку, что карта порождает жетон врага.
- Значение `enter: "random"` просит движок выбрать случайную локацию. В будущем могут появиться другие варианты (конкретный id, тип локации и т.д.).
- Каждая карта получает скрытое поле `instanceId`, по которому движок отличает одинаковые карты в колоде.
- Пока карта имеет `inPlay: true`, сброс невозможен: попытка вызовет предупреждение, а жетон врага остаётся на карте.
- Секция сброса показывает собранные события, автоматически синхронизируясь с последним снапшотом.

## Завершение
Для удаления виджета достаточно убрать его корневой элемент из DOM — дополнительных ресурсов он не удерживает. Чтобы сбросить колбэки, вызовите `deck.setIntentHandlers({})` перед демонтажем.
